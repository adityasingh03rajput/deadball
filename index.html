<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cosmic Goal Battle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
            touch-action: none;
            height: 100vh;
        }
        
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        canvas {
            display: block;
            background: #111;
        }
        
        #connection-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
        }
        
        .connection-box {
            background: #222;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 1px solid #444;
        }
        
        .scoreboard {
            position: absolute;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            font-size: 24px;
            z-index: 10;
            text-shadow: 0 0 5px #000;
        }
        
        .goal {
            position: absolute;
            width: 30px;
            height: 150px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            top: 50%;
            transform: translateY(-50%);
        }
        
        #red-goal {
            left: 0;
            border-right: none;
        }
        
        #blue-goal {
            right: 0;
            border-left: none;
        }
        
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            width: 100%;
            height: 120px;
            z-index: 5;
            pointer-events: none;
        }
        
        .joystick-area {
            position: absolute;
            left: 30px;
            bottom: 30px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            pointer-events: auto;
        }
        
        .joystick {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .shoot-btn {
            position: absolute;
            right: 30px;
            bottom: 30px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 50, 50, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            color: white;
            pointer-events: auto;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        @media (max-width: 768px) {
            .mobile-controls {
                display: block;
            }
        }
        
        #reconnect-btn {
            margin-top: 20px;
            padding: 10px 20px;
            background: #444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="scoreboard">
            <div id="red-score">RED: 0</div>
            <div id="blue-score">BLUE: 0</div>
        </div>
        
        <div id="red-goal" class="goal"></div>
        <div id="blue-goal" class="goal"></div>
        
        <canvas id="game-canvas"></canvas>
        
        <div class="mobile-controls">
            <div class="joystick-area" id="joystick-area">
                <div class="joystick" id="joystick"></div>
            </div>
            <div class="shoot-btn" id="shoot-btn">SHOOT</div>
        </div>
        
        <div id="connection-screen">
            <div class="connection-box">
                <h1 style="margin-bottom: 1rem;">COSMIC GOAL BATTLE</h1>
                <p id="connection-status">Connecting to server...</p>
                <div id="waiting-message" style="margin: 1rem 0; display: none;">
                    <p>Waiting for opponent to join...</p>
                </div>
                <button id="reconnect-btn" style="display: none;">Reconnect</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SERVER_URL = "https://deadiball.onrender.com"; // CHANGE THIS
        const PLAYER_SPEED = 5;
        const PLAYER_RADIUS = 20;
        const BALL_RADIUS = 15;
        
        // Game state
        let canvas, ctx;
        let socket;
        let playerRole = null;
        let gameActive = false;
        let localPlayer = {
            x: 0, y: 0,
            vx: 0, vy: 0,
            angle: 0,
            isShooting: false
        };
        let remotePlayer = {
            x: 0, y: 0,
            vx: 0, vy: 0,
            angle: 0
        };
        let ball = {
            x: 400, y: 300,
            vx: 0, vy: 0
        };
        let scores = { red: 0, blue: 0 };
        let keysPressed = {};
        let joystickActive = false;
        let joystickAngle = 0;
        let joystickDistance = 0;
        let joystickStartX, joystickStartY;
        
        // DOM elements
        const connectionScreen = document.getElementById('connection-screen');
        const connectionStatus = document.getElementById('connection-status');
        const waitingMessage = document.getElementById('waiting-message');
        const reconnectBtn = document.getElementById('reconnect-btn');
        const shootBtn = document.getElementById('shoot-btn');
        const joystick = document.getElementById('joystick');
        const joystickArea = document.getElementById('joystick-area');
        
        // Initialize game
        function initGame() {
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            setupControls();
            connectToServer();
            
            requestAnimationFrame(gameLoop);
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Position players based on role
            if (playerRole === 'red') {
                localPlayer.x = canvas.width * 0.2;
                localPlayer.y = canvas.height / 2;
            } else if (playerRole === 'blue') {
                localPlayer.x = canvas.width * 0.8;
                localPlayer.y = canvas.height / 2;
            }
        }
        
        function connectToServer() {
            socket = new WebSocket(SERVER_URL);
            
            socket.onopen = () => {
                connectionStatus.textContent = 'Connected to server!';
            };
            
            socket.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                switch(data.type) {
                    case 'init':
                        playerRole = data.role;
                        waitingMessage.style.display = 'block';
                        connectionStatus.textContent = `You are ${playerRole.toUpperCase()} player`;
                        scores = data.game_state.scores;
                        updateScoreboard();
                        resizeCanvas();
                        break;
                        
                    case 'game_start':
                        gameActive = true;
                        connectionScreen.style.display = 'none';
                        break;
                        
                    case 'game_update':
                        ball.x = data.ball.x;
                        ball.y = data.ball.y;
                        ball.vx = data.ball.vx;
                        ball.vy = data.ball.vy;
                        
                        if (playerRole === 'red') {
                            remotePlayer = data.players.blue;
                        } else {
                            remotePlayer = data.players.red;
                        }
                        break;
                        
                    case 'score_update':
                        scores = data.scores;
                        updateScoreboard();
                        break;
                        
                    case 'player_disconnected':
                        connectionScreen.style.display = 'flex';
                        connectionStatus.textContent = `${data.role.toUpperCase()} player disconnected!`;
                        reconnectBtn.style.display = 'block';
                        gameActive = false;
                        break;
                        
                    case 'error':
                        connectionStatus.textContent = data.message;
                        break;
                }
            };
            
            socket.onclose = () => {
                if (gameActive) {
                    connectionScreen.style.display = 'flex';
                    connectionStatus.textContent = 'Disconnected from server';
                    reconnectBtn.style.display = 'block';
                    gameActive = false;
                }
            };
            
            socket.onerror = (error) => {
                connectionStatus.textContent = 'Connection error';
                console.error('WebSocket error:', error);
            };
        }
        
        function setupControls() {
            // Keyboard controls
            window.addEventListener('keydown', (e) => {
                keysPressed[e.key] = true;
                if ([' ', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                }
            });
            
            window.addEventListener('keyup', (e) => {
                keysPressed[e.key] = false;
            });
            
            // Mobile controls
            joystickArea.addEventListener('touchstart', handleJoystickStart);
            document.addEventListener('touchmove', handleJoystickMove, { passive: false });
            document.addEventListener('touchend', handleJoystickEnd);
            
            shootBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                localPlayer.isShooting = true;
            });
            
            shootBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                localPlayer.isShooting = false;
            });
            
            // Reconnect button
            reconnectBtn.addEventListener('click', () => {
                location.reload();
            });
        }
        
        function handleJoystickStart(e) {
            const touch = e.touches[0];
            const rect = joystickArea.getBoundingClientRect();
            
            joystickStartX = rect.left + rect.width / 2;
            joystickStartY = rect.top + rect.height / 2;
            joystickActive = true;
            
            handleJoystickMove(e);
        }
        
        function handleJoystickMove(e) {
            if (!joystickActive) return;
            e.preventDefault();
            
            const touch = e.touches[0];
            const dx = touch.clientX - joystickStartX;
            const dy = touch.clientY - joystickStartY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const maxDistance = 40;
            
            joystickAngle = Math.atan2(dy, dx);
            joystickDistance = Math.min(distance, maxDistance);
            
            // Update joystick position
            const knobX = Math.cos(joystickAngle) * joystickDistance;
            const knobY = Math.sin(joystickAngle) * joystickDistance;
            
            joystick.style.transform = `translate(calc(-50% + ${knobX}px), calc(-50% + ${knobY}px)`;
        }
        
        function handleJoystickEnd(e) {
            if (!joystickActive) return;
            e.preventDefault();
            
            joystickActive = false;
            joystickDistance = 0;
            joystick.style.transform = 'translate(-50%, -50%)';
        }
        
        function updatePlayerMovement() {
            if (!gameActive) return;
            
            // Reset velocity
            localPlayer.vx = 0;
            localPlayer.vy = 0;
            
            // Keyboard controls
            if (playerRole === 'red') {
                if (keysPressed['ArrowUp']) localPlayer.vy = -PLAYER_SPEED;
                if (keysPressed['ArrowDown']) localPlayer.vy = PLAYER_SPEED;
                if (keysPressed['ArrowLeft']) localPlayer.vx = -PLAYER_SPEED;
                if (keysPressed['ArrowRight']) localPlayer.vx = PLAYER_SPEED;
            } else {
                if (keysPressed['w']) localPlayer.vy = -PLAYER_SPEED;
                if (keysPressed['s']) localPlayer.vy = PLAYER_SPEED;
                if (keysPressed['a']) localPlayer.vx = -PLAYER_SPEED;
                if (keysPressed['d']) localPlayer.vx = PLAYER_SPEED;
            }
            
            // Mobile controls
            if (joystickActive) {
                localPlayer.vx = Math.cos(joystickAngle) * PLAYER_SPEED * (joystickDistance / 40);
                localPlayer.vy = Math.sin(joystickAngle) * PLAYER_SPEED * (joystickDistance / 40);
            }
            
            // Apply movement
            localPlayer.x += localPlayer.vx;
            localPlayer.y += localPlayer.vy;
            
            // Boundary checks
            localPlayer.x = Math.max(PLAYER_RADIUS, Math.min(canvas.width - PLAYER_RADIUS, localPlayer.x));
            localPlayer.y = Math.max(PLAYER_RADIUS, Math.min(canvas.height - PLAYER_RADIUS, localPlayer.y));
            
            // Auto-aim at ball
            const dx = ball.x - localPlayer.x;
            const dy = ball.y - localPlayer.y;
            localPlayer.angle = Math.atan2(dy, dx);
            
            // Shooting
            if ((keysPressed[' '] || localPlayer.isShooting) && gameActive) {
                shootBall();
            }
            
            // Send update to server
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({
                    type: "player_update",
                    data: {
                        x: localPlayer.x,
                        y: localPlayer.y,
                        vx: localPlayer.vx,
                        vy: localPlayer.vy,
                        angle: localPlayer.angle
                    }
                }));
            }
        }
        
        function shootBall() {
            if (!gameActive) return;
            
            // Only red player can shoot in this simplified version
            if (playerRole === 'red' && socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify({
                    type: "goal",
                    scorer: "red"
                }));
            }
        }
        
        function checkGoal() {
            // Red goal (left)
            if (ball.x - BALL_RADIUS < 30 && 
                ball.y > (canvas.height - 150)/2 && 
                ball.y < (canvas.height + 150)/2) {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({
                        type: "goal",
                        scorer: "blue"
                    }));
                }
            }
            
            // Blue goal (right)
            if (ball.x + BALL_RADIUS > canvas.width - 30 && 
                ball.y > (canvas.height - 150)/2 && 
                ball.y < (canvas.height + 150)/2) {
                if (socket && socket.readyState === WebSocket.OPEN) {
                    socket.send(JSON.stringify({
                        type: "goal",
                        scorer: "red"
                    }));
                }
            }
        }
        
        function updateScoreboard() {
            document.getElementById('red-score').textContent = `RED: ${scores.red}`;
            document.getElementById('blue-score').textContent = `BLUE: ${scores.blue}`;
        }
        
        function drawPlayer(x, y, angle, color) {
            ctx.beginPath();
            ctx.arc(x, y, PLAYER_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            
            // Direction indicator
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(
                x + Math.cos(angle) * PLAYER_RADIUS * 1.5,
                y + Math.sin(angle) * PLAYER_RADIUS * 1.5
            );
            ctx.lineWidth = 3;
            ctx.strokeStyle = 'white';
            ctx.stroke();
        }
        
        function drawBall(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, BALL_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = '#9b59b6';
            ctx.fill();
            
            // Add some glow effect
            const gradient = ctx.createRadialGradient(
                x, y, BALL_RADIUS * 0.5,
                x, y, BALL_RADIUS * 1.5
            );
            gradient.addColorStop(0, 'rgba(155, 89, 182, 0.8)');
            gradient.addColorStop(1, 'rgba(155, 89, 182, 0)');
            
            ctx.beginPath();
            ctx.arc(x, y, BALL_RADIUS * 1.5, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
        }
        
        function gameLoop() {
            // Clear canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update game state
            if (gameActive) {
                updatePlayerMovement();
                checkGoal();
            }
            
            // Draw game objects
            drawPlayer(
                playerRole === 'red' ? localPlayer.x : remotePlayer.x,
                playerRole === 'red' ? localPlayer.y : remotePlayer.y,
                playerRole === 'red' ? localPlayer.angle : remotePlayer.angle,
                'red'
            );
            
            drawPlayer(
                playerRole === 'blue' ? localPlayer.x : remotePlayer.x,
                playerRole === 'blue' ? localPlayer.y : remotePlayer.y,
                playerRole === 'blue' ? localPlayer.angle : remotePlayer.angle,
                'blue'
            );
            
            drawBall(ball.x, ball.y);
            
            requestAnimationFrame(gameLoop);
        }
        
        // Start the game
        initGame();
    </script>
</body>
</html>
